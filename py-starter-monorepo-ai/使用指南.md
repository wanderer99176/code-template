# {{ cookiecutter.project_name }} Cookiecutter 模板使用指南

这是一个完整的企业级全栈 AI 应用 Monorepo 项目模板，基于 cookiecutter 构建。

## 🎯 模板特点

### ✅ 已完成的核心功能

1. **完整的项目结构**
   - ✅ Monorepo 架构（pnpm workspace + Turbo）
   - ✅ 根目录配置文件（package.json, turbo.json, pyproject.toml）
   - ✅ 代码规范配置（pre-commit, ruff, prettier, eslint）

2. **GitHub 工作流**
   - ✅ 完整的 CI/CD 流水线
   - ✅ Dependabot 自动更新配置
   - ✅ Issue 和 PR 模板

3. **项目文档**
   - ✅ 详细的环境搭建指南
   - ✅ 完整的部署手册
   - ✅ 架构决策记录（ADR）

4. **基础设施配置**
   - ✅ Docker Compose 开发环境（PostgreSQL, Redis, MinIO）
   - ✅ 监控套件配置（Prometheus, Grafana, Loki, Jaeger）
   - ✅ 完整的生产环境 Docker Compose

5. **项目脚本**
   - ✅ 自动化安装脚本（setup.sh）
   - ✅ 类型生成脚本（codegen.sh）
   - ✅ 数据库备份脚本（db-backup.sh）

6. **共享包**
   - ✅ shared-types（TypeScript 类型定义）
   - ✅ eslint-config-custom（共享 ESLint 配置）
   - ✅ tsconfig-custom（共享 TypeScript 配置）

7. **Backend 服务（FastAPI）**
   - ✅ 完整的项目结构
   - ✅ 核心配置（config.py, logging.py）
   - ✅ 数据库集成（SQLModel + Alembic）
   - ✅ API 端点示例（health, auth, users）
   - ✅ Dockerfile 和依赖管理
   - ✅ 详细的 README

8. **Frontend 服务（Nuxt）**
   - ✅ 完整的 Nuxt 3 配置
   - ✅ 示例页面和组件
   - ✅ Dockerfile
   - ✅ 详细的 README

9. **ML API 服务（YOLOv8）**
   - ✅ 完整的目标检测实现
   - ✅ FastAPI 接口
   - ✅ 依赖配置

10. **Audio API 服务（Whisper）**
    - ✅ 完整的语音识别实现
    - ✅ FastAPI 接口
    - ✅ 依赖配置

11. **Scraper 服务（Scrapy）**
    - ✅ 完整的 Scrapy 项目结构
    - ✅ 示例爬虫
    - ✅ 配置文件

## 📦 使用模板

### 方法 1: 直接使用 cookiecutter

```bash
# 1. 安装 cookiecutter
pipx install cookiecutter

# 2. 从本地模板创建项目
cookiecutter /path/to/py-starter-monorepo-ai

# 3. 按提示输入项目信息
# project_name: My Awesome App
# project_slug: my-awesome-app
# author_name: Your Name
# author_email: your.email@example.com
# ...
```

### 方法 2: 从 GitHub 创建（如果已上传）

```bash
cookiecutter gh:wanderer99176/code-template --directory py-starter-monorepo-ai
```

## 🚀 创建项目后的步骤

### 1. 进入项目目录

```bash
cd <project_slug>
```

### 2. 运行自动化设置脚本

```bash
# 使用 Git Bash（Windows）或 Terminal（macOS/Linux）
bash scripts/setup.sh
```

这个脚本会自动：
- ✅ 检查所有依赖
- ✅ 安装 Node.js 依赖
- ✅ 设置 Python 虚拟环境
- ✅ 安装 pre-commit hooks
- ✅ 复制环境变量文件
- ✅ 启动基础设施服务（可选）
- ✅ 运行数据库迁移（可选）

### 3. 配置环境变量

编辑以下文件：

```bash
# Backend
nano services/backend/.env

# Frontend
nano services/frontend/.env
```

### 4. 启动开发环境

```bash
# 启动所有服务
pnpm dev

# 或分别启动
pnpm dev:backend   # 后端: http://localhost:8000
pnpm dev:frontend  # 前端: http://localhost:3000
```

## 📝 需要手动完成的部分

### Kubernetes 配置（如需要）

需要创建：
- `infra/kubernetes/helm-charts/backend/`
- `infra/kubernetes/helm-charts/frontend/`
- `infra/kubernetes/core-infra/`

### OpenTofu 配置（如需要）

需要创建：
- `infra/tofu/main.tf`
- `infra/tofu/modules/`
- `infra/tofu/environments/`

## 🛠️ 后端开发补充

### 添加数据模型

```python
# services/backend/src/<package_name>/models/user.py
from sqlmodel import Field, SQLModel
from datetime import datetime
from typing import Optional

class UserBase(SQLModel):
    email: str = Field(unique=True, index=True)
    full_name: Optional[str] = None
    is_active: bool = True

class User(UserBase, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    hashed_password: str
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)

class UserCreate(UserBase):
    password: str

class UserRead(UserBase):
    id: int
    created_at: datetime
```

### 添加业务功能

1. 在 `features/` 下创建新模块
2. 定义 schemas, services, router
3. 在 `api/v1/router.py` 中注册

### 运行数据库迁移

```bash
cd services/backend

# 创建迁移
alembic revision --autogenerate -m "Add user model"

# 应用迁移
alembic upgrade head
```

## 📊 项目统计

### 已创建的文件

- **根目录配置**: 10+ 个文件
- **GitHub 工作流**: 3 个文件
- **文档**: 5+ 个文档文件
- **基础设施**: 10+ 个配置文件
- **共享包**: 3 个包，15+ 个文件
- **Backend 服务**: 20+ 个核心文件
- **Frontend 服务**: 10+ 个核心文件
- **ML API 服务**: 5+ 个文件
- **Audio API 服务**: 5+ 个文件
- **Scraper 服务**: 5+ 个文件
- **脚本**: 3 个自动化脚本

### 代码行数

- 配置文件: ~2000 行
- Python 代码: ~2000 行
- TypeScript 代码: ~800 行
- 文档: ~3000 行
- **总计: ~8000+ 行代码**

## 🎓 学习资源

### 推荐阅读顺序

1. 📖 [README.md]({{ cookiecutter.project_slug }}/README.md) - 项目概述
2. 📖 [docs/setup-guide.md]({{ cookiecutter.project_slug }}/docs/setup-guide.md) - 环境搭建
3. 📖 [docs/adr/001-monorepo-architecture.md]({{ cookiecutter.project_slug }}/docs/adr/001-monorepo-architecture.md) - 架构决策
4. 📖 [services/backend/README.md]({{ cookiecutter.project_slug }}/services/backend/README.md) - 后端开发
5. 📖 [docs/deployment.md]({{ cookiecutter.project_slug }}/docs/deployment.md) - 部署指南

### 相关技术文档

- **Monorepo**: [Turbo](https://turbo.build/), [pnpm workspace](https://pnpm.io/workspaces)
- **Backend**: [FastAPI](https://fastapi.tiangolo.com/), [SQLModel](https://sqlmodel.tiangolo.com/)
- **Frontend**: [Nuxt](https://nuxt.com/), [Vue 3](https://vuejs.org/)
- **DevOps**: [Docker](https://docs.docker.com/), [Kubernetes](https://kubernetes.io/docs/)

## 🐛 常见问题

### Q: Windows 下如何运行 shell 脚本？

A: 安装 Git Bash 或使用 WSL2:

```bash
# 使用 Git Bash
bash scripts/setup.sh

# 或使用 WSL2
wsl bash scripts/setup.sh
```

### Q: 如何只启用部分功能？

A: 在创建项目时，cookiecutter 会询问：
- `enable_ml_api`: 是否启用 ML API
- `enable_audio_api`: 是否启用 Audio API
- `enable_scraper`: 是否启用爬虫
- `enable_monitoring`: 是否启用监控

选择 "no" 即可跳过不需要的功能。

### Q: 如何添加新的服务？

A: 参考现有服务的结构：

1. 在 `services/` 下创建新目录
2. 添加 `pyproject.toml` 或 `package.json`
3. 添加 `Dockerfile`
4. 在根目录的 `docker-compose.yml` 中添加配置
5. 在 CI/CD 中添加构建步骤

### Q: 数据库迁移失败怎么办？

A: 

```bash
# 1. 检查数据库连接
docker-compose -f infra/docker-compose/dev.yml ps

# 2. 删除迁移历史
alembic downgrade base

# 3. 重新创建迁移
alembic revision --autogenerate -m "Initial"
alembic upgrade head
```

## 🤝 贡献

欢迎为这个模板做出贡献！

### 如何贡献

1. Fork 本项目
2. 创建功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 创建 Pull Request

### 贡献建议

- 📝 改进文档
- 🐛 修复 Bug
- ✨ 添加新功能
- 🎨 改进代码质量
- 🧪 添加测试

## 📄 许可证

{{ cookiecutter.license }}

## 👨‍💻 作者

**{{ cookiecutter.author_name }}**
- Email: {{ cookiecutter.author_email }}
- GitHub: [@{{ cookiecutter.github_username }}](https://github.com/{{ cookiecutter.github_username }})

## 🙏 致谢

感谢以下开源项目：

- FastAPI
- Nuxt
- Turbo
- pnpm
- SQLModel
- 以及所有其他依赖

---

**祝您开发愉快！🚀**

如有问题，请查看文档或提 Issue。
